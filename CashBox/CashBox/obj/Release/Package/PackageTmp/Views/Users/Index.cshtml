@{
    ViewBag.Title = "Users";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="content-wrapper">
    <div class="row">
        <div class="col-12 grid-margin">
            <div class="card">
                <div class="card-body">
                    <div class="col-lg-12 grid-margin stretch-card">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title">SYSTEM USERS</h4>
                                <button style="float: right" type="button" class="btn btn-inverse-primary btn-fw" data-toggle="modal" data-target="#createRequest">Add User</button>
                                <br /><br />
                                <div class="table-responsive" id="list">
                                    @Html.Partial("_List")
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<div id="divFormCreate">
    @Html.Partial("_Create", new CashBoxModel.Users())
</div>
<div id="divFormEdit">
    @Html.Partial("_Edit", new CashBoxModel.Users())
</div>
<div id="divFormDelete" style="display: none">
    @Html.Partial("_Delete", new CashBoxModel.Users())
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $('#example').DataTable();
    });

    function isNumber(evt) {
        evt = (evt) ? evt : window.event;
        var charCode = (evt.which) ? evt.which : evt.keyCode;
        if (charCode > 31 && (charCode < 48 || charCode > 57)) {
            return false;
        }
        return true;
    }

    function readFile() {
        if (this.files && this.files[0]) {
            var FR = new FileReader();
            FR.addEventListener("load", function (e) {
                $('#profileImg').val(e.target.result);
            });

            FR.readAsDataURL(this.files[0]);
        }
    }
    document.getElementById("imgUpload").addEventListener("change", readFile);

    function eReadFile() {
        if (this.files && this.files[0]) {
            var FR = new FileReader();
            FR.addEventListener("load", function (e) {
                $('#eprofileImg').val(e.target.result);
            });

            FR.readAsDataURL(this.files[0]);
        }
    }
    document.getElementById("eimgUpload").addEventListener("change", eReadFile);

    function loadDetails(id) {
        $.ajax({
            url: '@Url.Action("_LoadEdit", "Users")',
            method: "POST",
            cache: false,
            data: { id: id },
            success: function (member) {
                $('#txtID').val(member.ID);
                $('#mFirstName').val(member.FirstName);
                $('#mSurname').val(member.Surname);
                var dob = moment(member.DateOfBirth).format('DD-MM-YYYY');
                $('#mDateOfBirth').val(dob); //
                $('#mAddress').val(member.Address); //
                $('#mEmail').val(member.Email);
                $('#mPhone').val(member.Phone);
                $('#mRole').val(member.Role);
                $('#mSubUnit_FA').val(member.SubUnit_FA); //
                $('#mSubUnit_SU').val(member.SubUnit_SU); //
                var anniversary = moment(member.WeddingAnniversary).format('DD-MM-YYYY');
                $('#mWeddingAnniversary').val(anniversary); //
                $('#mNextOfKin').val(member.NextOfKin);
                $('#mNextOfKinPhone').val(member.NextOfKinPhone);
            },
            error: function () {
                alert('Unable to fetch member record.');
            }
        });
    }

    function ShowDeletePopUp(id) {
        $('#txtDeleteID').val(id);
        $('#btnDelete').click();
    }

    function Begin() {

    }

    function Successful() {
        $('#closeCreate').click();
        alert('New member added successfully.');
        $('#example').DataTable();
    }

    function UpdateBegin() {

    }

    function UpdateSuccessful() {
        $('#closeEdit').click();
        alert('Member record updated successfully.');
        $('#example').DataTable();
    }

    function DeleteBegin() {

    }

    function DeleteSuccessful() {
        alert('Member record deleted successfully.');
        $('#example').DataTable();
    }

    function Failed() {
        alert('Operation failed.');
    }
</script>
